<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Compatibility Reflection</title>
<style>
body { font-family: sans-serif; max-width: 720px; margin: auto; padding: 20px; }
button { display:block; width:100%; padding:10px; margin:8px 0; }
textarea { width:100%; padding:10px; margin-top:10px; }
.section { margin-bottom: 24px; }
.note { font-size: 0.9em; color: #555; }
.code { font-family: monospace; background:#f4f4f4; padding:10px; word-break:break-all; }
</style>
</head>

<body>

<h2 id="question"></h2>
<div id="options"></div>

<script>
// ---------------- QUESTIONS ----------------
const questions = [

  // --- Identity & Taste (contextual) ---
  { t:"text", q:"List up to 5 favourite movies (comma separated):" },
  { t:"text", q:"List up to 5 favourite series (comma separated):" },
  { t:"mcq", q:"What matters more to you in stories?", a:["Characters","Plot","Ideas","Emotion"], tag:"depth" },
  { t:"mcq", q:"Music you return to most often:", a:["Lyrics","Melody","Mood","Energy"] },

  // --- Daily life ---
  { t:"mcq", q:"Your ideal weekend looks like:", a:["Quiet & slow","Planned & active","Mixed"], tag:"energy" },
  { t:"mcq", q:"You recharge best by:", a:["Being alone","With one person","In a group"], tag:"closeness" },
  { t:"mcq", q:"You prefer conversations that are:", a:["Deep","Light","Situational"], tag:"depth" },

  // --- Emotional & relational style ---
  { t:"mcq", q:"During conflict, you usually:", a:["Withdraw","Need time then talk","Engage immediately"], tag:"conflict" },
  { t:"mcq", q:"When upset, you want your partner to:", a:["Give space","Check in","Act normally"], tag:"needs" },
  { t:"mcq", q:"You express care mostly through:", a:["Words","Actions","Presence"] },
  { t:"mcq", q:"Silence with someone you like feels:", a:["Comfortable","Awkward","Heavy"], tag:"closeness" },

  // --- Values & beliefs ---
  { t:"mcq", q:"Are you religious?", a:["Yes","Somewhat","No"], tag:"values" },
  { t:"mcq", q:"Do you want to date someone from the same religion?", a:["Yes","No","Not important"], tag:"values" },
  { t:"mcq", q:"Shared core values are:", a:["Essential","Important","Flexible"], tag:"values" },

  // --- Commitment & independence ---
  { t:"mcq", q:"How do you feel about long-term commitment?", a:["Actively want it","Open to it","Unsure"], tag:"commitment" },
  { t:"mcq", q:"Independence in a relationship feels:", a:["Essential","Balanced","Secondary"], tag:"closeness" },
  { t:"mcq", q:"Do you believe attraction can grow with time?", a:["Yes","Maybe","No"], tag:"patience" },

  // --- Boundaries & self-knowledge ---
  { t:"text", q:"One non-negotiable you have in a partner:" },
  { t:"text", q:"One thing you can adapt on over time:" },
  { t:"text", q:"One thing a potential partner must know about you early:" },
  { t:"text", q:"What drains you emotionally over time?" },

  // --- Meta consent ---
  { t:"mcq", q:"Are you willing to let an algorithm prioritise compatibility over instant spark?", a:["Yes","Maybe","No"], tag:"trust" }

];

// ---------------- STATE ----------------
// ---------------- STATE ----------------
let i = 0;
let responses = [];
let traits = { closeness:0, conflict:0, depth:0, values:0, patience:0 };
let userProfile = null;

// ---------------- SCORING ----------------
function score(v) {
  if (["Being alone","Withdraw","Essential","No"].includes(v)) return -1;
  if (["Balanced","Need time then talk","Maybe","Situational"].includes(v)) return 0;
  return 1;
}

// ---------------- RENDER ----------------
function render() {
  const q = questions[i];
  document.getElementById("question").innerText = q.q;
  const box = document.getElementById("options");
  box.innerHTML = "";

  // MCQ questions
  if (q.t === "mcq") {
    q.a.forEach(opt => {
      const b = document.createElement("button");
      b.innerText = opt;
      b.onclick = () => {
        if (q.tag) traits[q.tag] += score(opt);
        responses.push({ question: q.q, answer: opt });
        i++;
        i < questions.length ? render() : showAnalysis();
      };
      box.appendChild(b);
    });
  }

  // TEXT questions
  if (q.t === "text") {
    const textarea = document.createElement("textarea");
    textarea.rows = 3;
    textarea.placeholder = "Type your answer here…";
    box.appendChild(textarea);

    const nextBtn = document.createElement("button");
    nextBtn.innerText = "Next";
    nextBtn.onclick = () => {
      responses.push({ question: q.q, answer: textarea.value.trim() });
      i++;
      i < questions.length ? render() : showAnalysis();
    };
    box.appendChild(nextBtn);
  }
}
// ---------------- ANALYSIS ----------------
function showAnalysis() {
  userProfile = { ...traits };
  const code = btoa(JSON.stringify(userProfile));

  let you =
    traits.closeness < 0
    ? "You tend to experience closeness most comfortably when your independence is respected. You may care deeply while still needing internal space to process emotions."
    : "You tend to feel most secure when emotional presence and responsiveness are mutual and consistent.";

  let need =
    traits.depth > 0
    ? "You are likely to need meaningful conversation and emotional sincerity to feel connected."
    : "You benefit from a balance of depth and lightness rather than constant intensity.";

  let fit =
    traits.conflict < 0
    ? "You tend to do best with someone who doesn’t pressure immediate resolution and understands reflective processing."
    : "You tend to fit well with someone comfortable addressing issues openly and directly.";

  document.body.innerHTML = `
    <h2>Your Compatibility Reflection</h2>

    <div class="section"><h3>How you tend to be</h3><p>${you}</p></div>
    <div class="section"><h3>What you are likely to need</h3><p>${need}</p></div>
    <div class="section"><h3>Who tends to suit you best</h3><p>${fit}</p></div>

    <div class="section">
      <h3>Would you like to be considered for a compatibility match?</h3>
      <p class="note">
        Only people who explicitly opt in are considered. Matching, if any, is mutual and consensual.
      </p>
      <button onclick="optIn(true, '${code}')">Yes</button>
      <button onclick="optIn(false, '${code}')">No</button>
    </div>

    <p class="note">This reflection describes tendencies, not fixed traits.</p>
  `;
}

// ---------------- OPT-IN FLOW ----------------
function optIn(yes, code) {
  if (!yes) {
    document.body.innerHTML = `
      <h2>Reflection saved</h2>
      <p>You chose not to be considered for matching. You can keep this reflection for yourself.</p>
      <p class="note">You can retake the reflection anytime.</p>
    `;
    return;
  }

  document.body.innerHTML = `
    <h2>You’re opted in</h2>
    <p class="note">
      This anonymous compatibility code represents your trait pattern.
      Share it with the study facilitator to be considered for a match.
    </p>
    <div class="code">${code}</div>
    <p class="note">
      What happens next:
      <br>• Codes are compared only among people who opted in
      <br>• If a strong mutual match is found, both people are contacted
      <br>• No one is ranked or rejected publicly
    </p>
  `;
}

render();
</script>

</body>
</html>
